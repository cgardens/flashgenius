<div class="container">
  <div class="row">
    <div class="col-lg-12 text-center">
      <h1>All Decks</h1>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-4 col-md-offset-4">
      <% if !logged_in? %><%= link_to 'sign up / login', welcome_auth_path, class: "btn btn-xl" %><% end %>
      <input class='deck-search-bar form-control' type='text', placeholder="Search Decks"></input>
      <div class='search-decks-container'></div>
      <div class='decks-continer'>
        <% @decks.each do |deck| %>
          <br>
          <div class='deck'><%= link_to deck.name, user_deck_path(user_id: deck.user_id, id: deck.id) %> | <%= link_to deck.user.username, user_path(id: deck.user_id) %>
            <% if deck.user_id.to_i == current_user %>
              <p>This is one of your decks</p>
            <% else %>
              | <%= button_to 'copy deck to your profile', copy_deck_user_deck_path(user_id: deck.user_id, id: deck.id) %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>


<script>
  $('.deck-search-bar').on('keyup paste', function(){
    $.ajax({
      url: '/alldecks/live_search_decks',
      method: 'get',
      dataType: 'json',
      data: { 'search_query': $('.deck-search-bar').val() }
    }).done(function(data){
      $('.search-decks-container').empty()

      deckMatches = data.deckMatches
      if (!deckMatches) { return }
      deckMatchesLength = deckMatches.length


      for(var i = 0; i<deckMatchesLength; i++){
        $('.search-decks-container').append('<h4>search results</h4><div class=deck>' + '<a href=/users/' + deckMatches[i].user_id + '/decks/' + deckMatches[i].id + '/edit>' + deckMatches[i].name + '</a>' + '</div>')
      }

    }).fail(function(data){
      console.log('live search ajax request failed')
    })
  })
</script>